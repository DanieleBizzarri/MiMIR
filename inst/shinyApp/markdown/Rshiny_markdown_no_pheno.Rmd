---
title: "MiMIR report"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    toc: true
    toc_float:
      collapsed: false
    theme: paper
always_allow_html: true
params:
  metabo_measures: metabo_measures
  mort_score: mort_score
  MetaboAge: MetaboAge
  surrogates: surrogates
  predictors: predictors
  Nmax_miss_metaboAge: Nmax_miss_metaboAge
  Nmax_zero_metaboAge: Nmax_zero_metaboAge
  Nmax_miss_surrogates: Nmax_miss_surrogates
  Nmax_zero_surrogates:  Nmax_zero_surrogates
---

# Reading packages and variables
Required packages are loaded and the input variables are set. The used input settings are shown.

```{r setup,echo=FALSE}
if (!require("knitr")) install.packages("knitr")
if (!require("tidyr")) install.packages("tidyr")
if (!require("plotly")) install.packages("plotly")
if (!require("plyr")) install.packages("plyr")
#source("script/predictors_functions.R", local = knitr::knit_global())
```

```{r variables,echo=FALSE}
# IMPORT VARIABLES
metabo_measures<-params$metabo_measures
mort_score<-params$mort_score
MetaboAge<-params$MetaboAge
surrogates<-params$surrogates
predictors<-params$predictors
Nmax_miss_metaboAge<-params$Nmax_miss_metaboAge
Nmax_zero_metaboAge<-params$Nmax_miss_metaboAge
Nmax_miss_surrogates<-params$Nmax_miss_metaboAge
Nmax_zero_surrogates<-params$Nmax_miss_metaboAge
```

# Dataset Characteristics
### Dimensions of the files
```{r showVariables, echo=FALSE}
cat(paste0("Metabolites file dimensions: \nRows= ", dim(metabo_measures)[1], ", Columns= ", dim(metabo_measures)[2]),"\nAll the necessary metabolites were found available!")
```

## Metabolites
### Missingness of the metabolites
```{r missing metabolites, echo=FALSE}
plot_na_heatmap(t(metabo_measures[,MiMIR::metabolites_subsets$MET57]))
```

### Correlation of the metabolites 
```{r corr metabolites, echo=FALSE}
  res<-cor_assoc(metabo_measures,metabo_measures, MiMIR::metabolites_subsets$MET57, MiMIR::metabolites_subsets$MET57)
  plot_corply(res, main="Metabolites' Correlations", reorder.x=TRUE, abs=F, 
                      resort_on_p= TRUE,reorder_dend=F)
```

### Histogram metabolites
```{r histograms metabolites, echo=FALSE, out.width="150%", out.height="600%"}
multi_hist(metabo_measures[,MiMIR::metabolites_subsets$MET57])
```

# Predicted variables
### Quality Control for the predicted values calculated
```{r quality control, echo=FALSE}
cat("The quality control settings chosen for MetaboAge are:\n")
a<-QCprep(as.matrix(metabo_measures[,MiMIR::metabolites_subsets$MET63]),
       MiMIR::PARAM_metaboAge,quiet=FALSE,
       Nmax_miss=Nmax_miss_metaboAge,
       Nmax_zero=Nmax_zero_metaboAge)

cat("The quality control settings chosen for the Surrogates are:\n")
b<- QCprep_surrogates(as.matrix(metabo_measures[,MiMIR::metabolites_subsets$MET63]),
                       MiMIR::PARAM_surrogates,quiet=FALSE,
                       Nmax_miss=Nmax_miss_surrogates,
                       Nmax_zero=Nmax_zero_surrogates)

```

### Missingness of the binarized phenotypes
```{r missing predicted values, echo=FALSE}
  plot_na_heatmap(t(predictors[,-1]))
```

### Histogram predictors
```{r histograms predicted scores, echo=FALSE, out.width="130%", out.height="400%"}
  multi_hist(predictors[,-1])
```

## Correlations of the predictors
```{r corr predictors, echo=FALSE}
res<-cor_assoc(predictors, predictors, colnames(predictors)[-1],colnames(predictors)[-1])
plot_corply(res, main="Correlations of the Metabolic scores", reorder.x=TRUE, abs=F,
                    resort_on_p= TRUE,reorder_dend=F)
```
